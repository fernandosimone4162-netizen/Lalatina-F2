<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>LaLatina</title>
<style>
body { font-family: Arial; background:#111; color:#fff; text-align:center; }
button { padding:10px; margin:5px; }
input { padding:10px; width:80%; }
#hint { color:#0f0; }
</style>
</head>

<body>

<h1>LaLatina</h1>
<h2 id="phase">Fase 1</h2>
<h3 id="difficulty">Dificuldade: 1%</h3>

<p id="question"></p>

<input id="answer" placeholder="Digite em português">
<br>
<button onclick="submitAnswer()">Responder</button>
<button onclick="skipQuestion()" id="skipBtn" style="display:none;">Pular</button>

<p id="feedback"></p>
<p id="hint"></p>

<script>
/* ======================
   BANCO DE PERGUNTAS (DEMO)
   ====================== */

const phases = {};
for (let p = 1; p <= 10; p++) {
  phases[p] = [];
  for (let d = (p-1)*100+1; d <= p*100; d++) {
    phases[p].push({
      text: d <= 5 ? "Hello" :
            d <= 10 ? "Good morning" :
            d <= 20 ? "Good night" :
            d <= 40 ? "How are you?" :
            d <= 60 ? "What is your name?" :
            d <= 80 ? "Where are you from?" :
            "Can you help me?",
      hint: "Frase comum do dia a dia",
      difficulty: d
    });
  }
}

/* ======================
   ESTADO DO USUÁRIO
   ====================== */

let state = JSON.parse(localStorage.getItem("lalatina")) || {
  phase: 1,
  difficulty: 1,
  attempts: 0,
  corrects: 0,
  examUnlocked: false
};

let currentQuestion = null;

/* ======================
   FUNÇÕES PRINCIPAIS
   ====================== */

function speak(text) {
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = "en-US";
  speechSynthesis.speak(utter);
}

function loadQuestion() {
  const pool = phases[state.phase].filter(q => q.difficulty === state.difficulty);
  currentQuestion = pool[Math.floor(Math.random()*pool.length)];
  document.getElementById("question").innerText = currentQuestion.text;
  document.getElementById("difficulty").innerText = "Dificuldade: " + state.difficulty + "%";
  document.getElementById("hint").innerText = "";
  document.getElementById("feedback").innerText = "";
  document.getElementById("skipBtn").style.display = "none";
  state.attempts = 0;
  speak(currentQuestion.text);
}

function normalize(txt) {
  return txt.toLowerCase().replace(/[^\w\s]/g,"").trim();
}

function submitAnswer() {
  const user = normalize(document.getElementById("answer").value);
  state.attempts++;

  // Validação semântica simulada
  const accepted = [
    "oi","olá","bom dia","boa noite",
    "como vai","qual é seu nome",
    "de onde você é","você pode me ajudar"
  ];

  if (accepted.some(a => user.includes(a))) {
    correct();
  } else {
    wrong();
  }
}

function correct() {
  document.getElementById("feedback").innerText = "Correto!";
  state.corrects++;
  if (state.attempts < 3) state.difficulty++;
  save();
  checkProgress();
  setTimeout(loadQuestion,1000);
}

function wrong() {
  document.getElementById("feedback").innerText = "Tente novamente";
  if (state.attempts === 3) {
    document.getElementById("hint").innerText = "Dica: " + currentQuestion.hint;
  }
  if (state.attempts >= 5) {
    document.getElementById("skipBtn").style.display = "inline";
  }
  save();
}

function skipQuestion() {
  state.difficulty = Math.max((state.phase-1)*100+1, state.difficulty-2);
  save();
  loadQuestion();
}

function checkProgress() {
  if (state.corrects >= 100 && !state.examUnlocked) {
    state.examUnlocked = true;
    alert("Prova liberada!");
  }
}

function save() {
  localStorage.setItem("lalatina", JSON.stringify(state));
}

document.getElementById("phase").innerText = "Fase " + state.phase;
loadQuestion();
</script>

</body>
</html>

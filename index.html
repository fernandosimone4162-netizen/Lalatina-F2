<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>LaLatina â€“ Fase 1 (Teste)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    font-family: Arial, sans-serif;
    background: #0f1220;
    color: #fff;
    padding: 20px;
}
.card {
    background: #1c2040;
    padding: 20px;
    border-radius: 10px;
    max-width: 500px;
    margin: auto;
}
button {
    padding: 10px;
    margin-top: 10px;
    width: 100%;
    font-size: 16px;
    border: none;
    border-radius: 5px;
}
input {
    width: 100%;
    padding: 10px;
    font-size: 16px;
}
#hint {
    margin-top: 10px;
    color: #ffd966;
}
#skipBtn {
    background: #b33;
    display: none;
}
#submitBtn {
    background: #3b7cff;
}
</style>
</head>

<body>

<div class="card">
    <h2>LaLatina â€“ Fase 1</h2>
    <p><strong>Dificuldade:</strong> <span id="difficulty">1%</span></p>

    <p id="questionText"></p>

    <button onclick="playAudio()">ðŸ”Š Ouvir</button>

    <input type="text" id="answer" placeholder="Digite em portuguÃªs">

    <button id="submitBtn" onclick="checkAnswer()">Responder</button>
    <button id="skipBtn" onclick="skipQuestion()">Pular pergunta</button>

    <p id="hint"></p>
    <p id="feedback"></p>
</div>

<script>
/* =========================
   BANCO DE PERGUNTAS (Fase 1)
   InglÃªs -> PortuguÃªs
========================= */
const questions = [
    { id: 1, text: "Hi", answers: ["oi", "olÃ¡"], difficulty: 1, hint: "Forma informal de cumprimento" },
    { id: 2, text: "Hello", answers: ["olÃ¡", "oi"], difficulty: 2, hint: "Cumprimento comum" },
    { id: 3, text: "Good morning", answers: ["bom dia"], difficulty: 3, hint: "Usado ao acordar" },
    { id: 4, text: "Good afternoon", answers: ["boa tarde"], difficulty: 4, hint: "Depois do almoÃ§o" },
    { id: 5, text: "Good night", answers: ["boa noite"], difficulty: 5, hint: "Antes de dormir" }
];

/* =========================
   ESTADO DO ALGORITMO
========================= */
let currentDifficulty = 1;
let attempts = 0;
let currentQuestion = null;

/* =========================
   NORMALIZA TEXTO
========================= */
function normalize(text) {
    return text
        .toLowerCase()
        .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
        .replace(/[^\w\s]/gi, "")
        .trim();
}

/* =========================
   ESCOLHE PERGUNTA
========================= */
function loadQuestion() {
    attempts = 0;
    document.getElementById("hint").innerText = "";
    document.getElementById("feedback").innerText = "";
    document.getElementById("skipBtn").style.display = "none";
    document.getElementById("answer").value = "";

    const pool = questions.filter(q => q.difficulty === currentDifficulty);
    currentQuestion = pool[Math.floor(Math.random() * pool.length)];

    document.getElementById("questionText").innerText = currentQuestion.text;
    document.getElementById("difficulty").innerText = currentDifficulty + "%";

    playAudio();
}

/* =========================
   ÃUDIO EM INGLÃŠS
========================= */
function playAudio() {
    const utterance = new SpeechSynthesisUtterance(currentQuestion.text);
    utterance.lang = "en-US";
    speechSynthesis.speak(utterance);
}

/* =========================
   VERIFICA RESPOSTA
========================= */
function checkAnswer() {
    attempts++;
    const userAnswer = normalize(document.getElementById("answer").value);

    const correct = currentQuestion.answers.some(a =>
        normalize(a) === userAnswer
    );

    if (correct) {
        document.getElementById("feedback").innerText = "âœ… Correto!";

        if (attempts < 3) {
            currentDifficulty++;
        }

        saveProgress(true);
        loadQuestion();
    } else {
        document.getElementById("feedback").innerText = "âŒ Incorreto. Tente novamente.";

        if (attempts === 3) {
            document.getElementById("hint").innerText = "ðŸ’¡ Dica: " + currentQuestion.hint;
        }

        if (attempts >= 5) {
            document.getElementById("skipBtn").style.display = "block";
        }

        saveProgress(false);
    }
}

/* =========================
   PULAR PERGUNTA
========================= */
function skipQuestion() {
    currentDifficulty = Math.max(1, currentDifficulty - 2);
    loadQuestion();
}

/* =========================
   SALVAMENTO (SIMULA GOOGLE)
========================= */
function saveProgress(correct) {
    let data = JSON.parse(localStorage.getItem("lalatina_progress")) || {
        attempts: 0,
        errors: 0
    };

    data.attempts++;
    if (!correct) data.errors++;

    localStorage.setItem("lalatina_progress", JSON.stringify(data));
}

/* =========================
   INICIAR
========================= */
loadQuestion();
</script>

</body>
</html>
